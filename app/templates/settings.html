{% extends 'base.html' %}

{% block title %}Settings{% endblock %}

{% block content %}
<script src="/MyJavaScript.js" defer></script>
<h1>User Preferences</h1>
<form id="preferencesForm" method="POST"> <!-- Added method="POST" to the form -->
    <p>
        <label for="vaultTimeout">Vault Timeout:</label>
        <select id="vaultTimeout" name="vaultTimeout">
            <option value="5">5 minutes</option>
            <option value="10">10 minutes</option>
            <option value="15">15 minutes</option>
        </select>
    </p>
    <p>
        <label for="themeId">Theme:</label>
        <select id="themeId" name="themeId">
            <option value="dark">Dark</option>
            <option value="light">Light</option>
        </select>
    </p>

    <p>
        <button type="submit">Save Preferences</button>
    </p>
</form>

<script>
    document.getElementById("preferencesForm").addEventListener("submit", function(event) {
        event.preventDefault(); // Prevent the form from submitting

        // Fetch values from input fields
        var vaultTimeout = document.getElementById("vaultTimeout").value;
        var themeId = document.getElementById("themeId").value;
        var settingsHtml = document.getElementById("settingsHtml").value; // Get HTML content

        // Prepare data to send to the server
        var data = {
            vaultTimeout: vaultTimeout,
            themeId: themeId,
            settingsHtml: settingsHtml // Include HTML content
        };

        // Send an AJAX request to the server
        fetch('/settings', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Failed to save preferences');
            }
            // Handle success, e.g., show a success message
            console.log('Preferences saved successfully');
        })
        .catch(error => {
            // Handle error, e.g., show an error message
            console.error('Error saving preferences:', error);
        });
    });
</script>

{% endblock %}